# PhotoSlide - Google Photos Album Slideshow App

## 프로젝트 개요

**앱 이름**: PhotoSlide
**플랫폼**: macOS (Electron)
**목적**: 구글 포토 앨범을 디지털 액자처럼 자동 재생하는 슬라이드쇼 앱

---

## 기술 스택

### Core
- Electron
- React
- TypeScript

### 주요 라이브러리
- `electron` - 데스크톱 앱 프레임워크
- `react` / `react-dom` - UI 프레임워크 (**19.0.2+, 19.1.3+, 또는 19.2.2+ 사용 권장** - CVE-2025-55183 패치)
- `electron-store` - 로컬 데이터 저장
- `googleapis` - Google API 클라이언트
- `node-cache` - 메모리 캐싱
- `node-cron` - 스케줄 관리

### 보안 주의사항
- **CVE-2025-55183**: React Server Components 정보 유출 취약점
  - 취약 버전: 19.0.0~19.0.1, 19.1.0~19.1.2, 19.2.0~19.2.1
  - 패치 버전: **19.0.2, 19.1.3, 19.2.2**
  - 영향 패키지: react-server-dom-parcel, react-server-dom-turbopack, react-server-dom-webpack
  - 참고: Electron 클라이언트 전용 앱에서는 Server Components를 사용하지 않으면 직접적 영향 없음

### 빌드 도구
- `electron-builder` - 앱 패키징 및 배포
- `vite` - 번들링 및 개발 서버
- `@electron/notarize` - macOS 앱 공증

---

## 화면 구조

```
├── 스플래시 화면
├── 로그인 화면
├── 앨범 목록 화면
├── 슬라이드쇼 화면
└── 설정 화면
    ├── 슬라이드 간격 설정
    ├── 스케줄 설정 (격자 UI)
    ├── 앨범 재선택
    ├── 창 모드 설정
    ├── 사진 순서 설정
    ├── 전환 효과 설정
    └── 시스템 시작 시 자동 실행
```

---

## 주요 기능

### 1. 인증 기능

#### 1.1 로그인
- Google OAuth 2.0 인증
- Electron의 BrowserWindow를 이용한 OAuth 플로우
- 필요한 권한: `https://www.googleapis.com/auth/photoslibrary.readonly`

#### 1.2 로그아웃
- 토큰 제거
- 로컬 데이터 초기화

#### 1.3 계정 변경
- 현재 계정 로그아웃
- 새 계정으로 로그인

---

### 2. 앨범 선택

#### 2.1 앨범 목록 표시
- Google Photos API로 앨범 목록 가져오기
- 그리드 형식으로 앨범 썸네일 표시
- 앨범명, 사진 개수 표시

#### 2.2 앨범 선택
- 단일 앨범 선택
- 여러 앨범 선택 (멀티 선택 모드)
- 선택한 앨범 정보 로컬 저장

#### 2.3 앨범 재선택
- 설정 메뉴에서 앨범 변경 가능

---

### 3. 슬라이드쇼

#### 3.1 기본 동작
- 전체 화면 모드 지원
- 자동 페이지 넘김 (설정된 간격)
- 무한 루프 (마지막 사진 → 첫 사진)
- 이미지 로딩 최적화 (다음 이미지 미리 로드)
- 화면 절전 모드 방지 (powerSaveBlocker)

#### 3.2 키보드/마우스 제스처
- **ESC**: 슬라이드쇼 종료
- **Space**: 일시정지/재생
- **방향키 좌/우**: 수동 이미지 전환
- **클릭**: 컨트롤 UI 표시/숨김
- **더블클릭**: 전체화면 토글

#### 3.3 컨트롤 UI
- **일시정지/재생 버튼**: 자동 슬라이드 일시 정지 및 재개
- **이전/다음 버튼**: 수동 이미지 전환
- **설정 버튼**: 설정 메뉴 열기
- **전체화면 버튼**: 전체화면 전환
- **종료 버튼**: 슬라이드쇼 종료

#### 3.4 사진 순서 설정
- **최신순**: 가장 최근 사진부터 재생
- **오래된순**: 가장 오래된 사진부터 재생
- **랜덤**: 무작위 순서로 재생

#### 3.5 여러 앨범 재생
- 선택한 여러 앨범의 사진을 섞어서 재생
- 앨범별 순서 유지 또는 전체 섞기 옵션

#### 3.6 전환 효과
- **없음**: 즉시 전환
- **페이드**: 서서히 사라지고 나타남
- **슬라이드**: 좌우로 슬라이딩
- **줌**: 확대/축소 효과

---

### 4. 설정 옵션

#### 4.1 슬라이드 간격 설정
- **범위**: 5초 ~ 60초
- **UI**: 슬라이더 + 숫자 표시
- **기본값**: 10초

#### 4.2 스케줄 설정 (격자 UI)

##### UI 구조
```
        0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15 16 17 18 19 20 21 22 23
월     [ ][ ][ ][ ][ ][ ][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][ ][ ]
화     [ ][ ][ ][ ][ ][ ][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][ ][ ]
수     [ ][ ][ ][ ][ ][ ][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][ ][ ]
목     [ ][ ][ ][ ][ ][ ][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][ ][ ]
금     [ ][ ][ ][ ][ ][ ][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][ ][ ]
토     [■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■]
일     [■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■][■]
```

##### 레이아웃
- 7행 (요일: 월~일) × 24열 (시간: 0~23시)
- 총 168개의 셀
- 가로 스크롤 가능

##### 인터랙션
- **클릭**: 개별 셀 토글 (켜짐 ↔ 꺼짐)
- **드래그**: 여러 셀 한번에 선택/해제
- **요일 라벨 클릭**: 해당 요일 전체 선택/해제
- **시간 라벨 클릭**: 해당 시간 전체 요일 선택/해제

##### 시각 디자인
- **선택됨 (켜짐)**: 파란색 또는 초록색 배경
- **선택 안됨 (꺼짐)**: 회색 또는 흰색 배경
- **셀 크기**: 클릭하기 적절한 크기 (최소 30x30px)
- **구분선**: 얇은 그리드 라인

##### 편의 기능
- "전체 선택" 버튼
- "전체 해제" 버튼
- "평일만" 프리셋 (월~금, 6~22시)
- "주말만" 프리셋 (토~일, 전체 시간)
- 스케줄 활성화/비활성화 토글

##### 동작 로직
1. 앱 시작 시: 현재 요일과 시간 확인
2. 스케줄 체크: `timeGrid[현재요일][현재시간]` 값 확인
3. true인 경우: 슬라이드쇼 자동 시작
4. false인 경우: 앱 대기 상태
5. 매 시간 정각마다: 스케줄 재확인 및 상태 변경

#### 4.3 창 모드 설정
- **창 모드** (Windowed): 일반 창으로 실행
- **전체 화면** (Fullscreen): 전체 화면 모드
- 앱 실행 시 적용

#### 4.4 시스템 시작 시 자동 실행
- macOS 로그인 항목에 등록/해제
- `app.setLoginItemSettings()` 활용

#### 4.5 앨범 재선택
- 현재 선택된 앨범 확인
- 앨범 목록으로 이동하여 재선택

---

## 데이터 구조

### electron-store 저장 데이터

```typescript
{
  // 사용자 인증 정보
  userToken: string,
  refreshToken: string,
  tokenExpiry: number,

  // 선택된 앨범 정보
  selectedAlbums: [
    {
      id: string,
      title: string,
      coverPhotoUrl: string,
      photosCount: number
    }
  ],

  // 캐시된 미디어 아이템 (API 절약용)
  cachedMediaItems: [
    {
      id: string,
      baseUrl: string,
      mimeType: string,
      creationTime: string,
      albumId: string,
      cachedAt: number
    }
  ],
  lastSync: number,

  // 앱 설정
  settings: {
    // 슬라이드 간격 (초)
    slideInterval: number,

    // 스케줄 설정
    schedule: {
      enabled: boolean,
      timeGrid: boolean[][] // [7요일][24시간]
      // 예: timeGrid[0][9] = true → 월요일 9시 켜짐
    },

    // 창 모드
    windowMode: 'windowed' | 'fullscreen',

    // 사진 순서
    photoOrder: 'latest' | 'oldest' | 'random',

    // 여러 앨범 재생 시 섞기
    shuffleAlbums: boolean,

    // 전환 효과
    transitionEffect: 'none' | 'fade' | 'slide' | 'zoom',

    // 시스템 시작 시 자동 실행
    launchAtLogin: boolean
  }
}
```

---

## Google Photos API

### 필요한 OAuth Scopes
- `https://www.googleapis.com/auth/photoslibrary.readonly`

### 주요 API 엔드포인트
- `albums.list`: 앨범 목록 가져오기
- `mediaItems.search`: 앨범 내 사진 검색
- `mediaItems.get`: 개별 사진 정보
- `mediaItems.batchGet`: 여러 사진 정보 일괄 조회

---

## API 쿼터 관리 전략

### 쿼터 제한
- 일반 API 요청: 10,000/일
- 미디어 바이트 접근: 75,000/일
- 가격: 무료 (쿼터 내)

### 필수 캐싱 레이어

#### 1. 메타데이터 캐싱 (electron-store)
- mediaItems 데이터 로컬 저장
- 24시간마다 또는 수동으로만 재동기화
- 절약 효과: API 요청 90% 감소

#### 2. 이미지 파일 캐싱 (디스크 캐시)
- 앱 데이터 폴더에 이미지 저장
- 캐시 크기 제한: 500MB ~ 1GB
- LRU 정책으로 자동 관리
- 절약 효과: 미디어 로딩 96% 감소

#### 3. baseUrl 갱신 전략
- 슬라이드쇼 시작 시 1회 검증
- 50분마다 백그라운드 갱신 (60분 만료 대비)
- mediaItems:batchGet API 사용 (50개/요청)

### 확장성 목표
- 초기 출시: 100명 지원 (쿼터의 20% 사용)
- 중기 목표: 250명 지원 (쿼터 100% 활용)
- 장기 목표: Partner Program 신청 → 2,500명+

### 에러 대응
- 429 에러: Exponential backoff (1초 → 2초 → 4초)
- 네트워크 단절: 로컬 캐시로 fallback
- baseUrl 만료: 자동 재요청

---

## 개발 단계

### Phase 1: 기본 구조
1. Electron + React + TypeScript 프로젝트 생성
2. Vite 기반 개발 환경 설정
3. Google OAuth 연동 (BrowserWindow 기반)
4. 기본 UI 레이아웃 및 라우팅

### Phase 2: 핵심 기능 + API 캐싱
1. Google Photos API 연동
2. 앨범 목록 화면 구현
3. **API 캐싱 시스템 구현 (필수)**
   - electron-store에 mediaItems 메타데이터 저장
   - 디스크 기반 이미지 캐시
   - baseUrl 자동 갱신 로직 (50분 주기)
   - 429 에러 핸들링 (exponential backoff)
4. 기본 슬라이드쇼 구현
5. 이미지 로딩 및 캐싱

### Phase 3: 설정 기능
1. 슬라이드 간격 설정
2. 스케줄 격자 UI 구현
3. 창 모드 제어 (windowed/fullscreen)
4. 사진 순서 설정
5. 전환 효과 구현

### Phase 4: 고급 기능
1. 여러 앨범 선택 및 섞기
2. 일시정지/재생 컨트롤
3. 백그라운드 스케줄 동작 (트레이 아이콘)
4. 시스템 시작 시 자동 실행
5. 전역 단축키 등록

### Phase 5: 최적화 및 배포
1. 성능 최적화
2. 메모리 관리
3. 에러 핸들링
4. macOS 앱 서명 및 공증
5. DMG 패키지 생성
6. 자동 업데이트 기능 (electron-updater)

---

## 주의사항

### 성능
- 고해상도 이미지 메모리 관리
- 이미지 리사이징으로 메모리 최적화
- 슬라이드쇼 중 3-5장만 메모리에 유지

### API 제한
- Google Photos API 호출 제한 고려
- 적절한 캐싱 전략 필수
- 네트워크 에러 핸들링

### macOS 통합
- 다크 모드 지원 (nativeTheme)
- 메뉴바 아이콘으로 백그라운드 실행
- Dock 아이콘 숨김 옵션
- 알림 센터 연동

### 보안
- OAuth 토큰 안전한 저장 (safeStorage 활용)
- Context Isolation 활성화
- nodeIntegration 비활성화

---

## UI/UX 고려사항

### 디자인 원칙
- 미니멀하고 직관적인 인터페이스
- macOS 네이티브 느낌 유지
- 명확한 시각적 피드백

### 접근성
- 적절한 폰트 크기
- 충분한 색상 대비
- 키보드 네비게이션 지원

### 사용자 경험
- 빠른 로딩 시간
- 부드러운 애니메이션 (CSS/Framer Motion)
- 명확한 에러 메시지

---

## 향후 확장 가능성

### 추가 기능 아이디어
- 음악 재생 (배경 음악)
- 날씨 정보 오버레이
- 시계 표시 옵션
- 여러 기기 동기화
- Windows 버전 개발
- 메뉴바 전용 미니 플레이어

### 수익화 전략

#### 무료 버전
- 앨범 1개만 선택 가능
- 기본 전환 효과만 제공
- 스케줄 기능 없음
- 광고 없음 (사용자 경험 우선)

#### 프리미엄 버전 ($3.99 일회성 구매)
- 무제한 앨범 선택
- 모든 전환 효과 (페이드, 슬라이드, 줌)
- 7×24 스케줄 격자 (핵심 기능)
- 우선 고객 지원

---

## 개발 참고 자료

- [Electron 공식 문서](https://www.electronjs.org/docs)
- [Google Photos API 문서](https://developers.google.com/photos)
- [electron-builder 문서](https://www.electron.build/)
- [Vite + Electron 템플릿](https://github.com/electron-vite/electron-vite-react)

---

**작성일**: 2025-10-14
**수정일**: 2025-12-16
**버전**: 2.0 (Electron 기반으로 변경)
